(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var e=function(){function e(t,n){var o=t.renderer;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this._renderer=o,this._container=document.querySelector(n)}var n,o;return n=e,(o=[{key:"renderer",value:function(t){var e=this;t.reverse().forEach((function(t){return e._renderer(t)}))}},{key:"addItem",value:function(t){this._container.prepend(t)}}])&&t(n.prototype,o),e}();function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var o=function(){function t(e,n,o,r,i,a,u){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._data=e,this._link=e.link,this._name=e.name,this._userId=e.owner._id,this._idCard=e._id,this._likes=e.likes.length,this._cardSelector=n,this.handleCardClick=o,this._userOwnerId=u,this._handleLikeCard=r,this._handleDeleteCardLike=i,this._hadleDeleteCardButton=a}var e,o;return e=t,(o=[{key:"_getTemplate",value:function(){return document.querySelector(this._cardSelector).content.querySelector(".photo").cloneNode(!0)}},{key:"generateCard",value:function(){return this._element=this._getTemplate(),this._setEventListeners(),this._photoImg=this._element.querySelector(".photo__img"),this._photoImg.src=this._link,this._photoImg.alt=this._name,this._element.querySelector(".photo__title").textContent=this._name,this._likeCounter=this._element.querySelector(".photo__like-counter"),this._likeCounter.textContent=this._likes,this._userId===this._userOwnerId&&(this._deleteBtn.classList.remove("photo__delete_inactive"),this._deleteBtn.removeAttribute("disabled")),this._element}},{key:"_setEventListeners",value:function(){var t=this;this._likeBtn=this._element.querySelector(".photo__like"),this._likeBtn.addEventListener("click",(function(){t._likeBtn.classList.contains("photo__like_active")?(t._handleLikeDelete(),t._handleDeleteCardLike(t._idCard)):(t._handleAddLike(),t._handleLikeCard(t._idCard))})),this._deleteBtn=this._element.querySelector(".photo__delete"),this._deleteBtn.addEventListener("click",(function(){t._hadleDeleteCardButton(t._element,t._idCard)})),this._photoCard=this._element.querySelector(".photo__img"),this._photoCard.addEventListener("click",(function(){t.handleCardClick()}))}},{key:"_handleAddLike",value:function(){this._likeBtn.classList.toggle("photo__like_active"),this._likeCounter.textContent=this._likes+1}},{key:"_handleLikeDelete",value:function(){this._likeBtn.classList.toggle("photo__like_active"),this._likeCounter.textContent=this._likes}}])&&n(e.prototype,o),t}();function r(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var i=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._form=n,this._input=e.inputSelector,this._submitBtn=e.submitButtonSelector,this._textError=e.activeTextError,this._inputError=e.inputErrorActive,this._inactiveBtn=e.inactiveButtonClass,this._textErrorInput=e.textError}var e,n;return e=t,(n=[{key:"enableValidation",value:function(t){this._form.addEventListener("submit",(function(t){t.preventDefault()})),this._setEventListeners()}},{key:"_setEventListeners",value:function(){var t=this;this._inputList=Array.from(this._form.querySelectorAll(this._input)),this._buttonElement=this._form.querySelector(this._submitBtn),this._inputList.forEach((function(e){e.addEventListener("input",(function(){t._checkInputValid(e),t._toggleButtonState(e)}))}))}},{key:"_checkInputValid",value:function(t){var e=t.validity.valid,n=t.validationMessage;e?this._hideInputError(t):this._showInputError(t,n)}},{key:"_hideInputError",value:function(t){var e=this._form.querySelector("#".concat(t.id,"-error"));e.textContent="",e.classList.remove(this._textError),t.classList.remove(this._inputError)}},{key:"_showInputError",value:function(t,e){var n=this._form.querySelector("#".concat(t.id,"-error"));n.textContent=e,n.classList.add(this._textError),t.classList.add(this._inputError)}},{key:"_toggleButtonState",value:function(t){this._inputList.some((function(t){return!t.validity.valid}))?(this._buttonElement.setAttribute("disabled",!0),this._buttonElement.classList.add(this._inactiveBtn)):(this._buttonElement.removeAttribute("disabled"),this._buttonElement.classList.remove(this._inactiveBtn))}},{key:"resetErrorOpenPopup",value:function(){var t=this;Array.from(this._form.querySelectorAll(this._input)).forEach((function(e){e.classList.remove(t._inputError)})),Array.from(this._form.querySelectorAll(this._textErrorInput)).forEach((function(t){t.textContent=""}))}}])&&r(e.prototype,n),t}();function a(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var u=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._popupSelector=e,this._toggleEscEventLisneter=function(t){this._handleEscClose(t)},this.toggleEsc=this._toggleEscEventLisneter.bind(this)}var e,n;return e=t,(n=[{key:"open",value:function(){this._popupSelector.classList.add("popup_opened"),document.addEventListener("keydown",this.toggleEsc)}},{key:"close",value:function(){this._popupSelector.classList.remove("popup_opened"),document.removeEventListener("keydown",this.toggleEsc)}},{key:"_handleEscClose",value:function(t){"Escape"===t.key&&this.close()}},{key:"setEventListeners",value:function(){var t=this;this._popupSelector.addEventListener("click",(function(e){(e.target.classList.contains("popup_opened")||e.target.classList.contains("popup-close"))&&t.close()}))}}])&&a(e.prototype,n),t}();function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function l(t,e,n){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=h(t)););return t}(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(t,e){return!e||"object"!==c(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var d=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}(a,t);var e,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=h(o);if(r){var n=h(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return f(this,t)});function a(t,e){var n,o=t.submitFunction;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,e))._submitFunction=o,n._form=n._popupSelector.querySelector(".popup__form"),n._buttonTextActive=n._form.querySelector(".popup__save-button"),n._buttonTextDefault=n._form.querySelector(".popup__save-button").value,n}return e=a,(n=[{key:"_getInputValues",value:function(){var t=this;return this._inputList=this._form.querySelectorAll(".popup__input"),this._formValues={},this._inputList.forEach((function(e){t._formValues[e.name]=e.value})),this._formValues}},{key:"setEventListeners",value:function(){var t=this;l(h(a.prototype),"setEventListeners",this).call(this),this._popupSelector.addEventListener("submit",(function(e){e.preventDefault(),t._submitFunction(t._getInputValues())}))}},{key:"openPopupDelete",value:function(t,e){l(h(a.prototype),"open",this).call(this),this._card=t,this._idCard=e}},{key:"setEventListenersDelete",value:function(){var t=this;l(h(a.prototype),"setEventListeners",this).call(this),this._popupSelector.addEventListener("submit",(function(e){e.preventDefault(),t._submitFunction(t._idCard,t._card)}))}},{key:"close",value:function(){l(h(a.prototype),"close",this).call(this),this._form.reset()}},{key:"renderLoading",value:function(t,e){this._buttonTextActive=t?e:this._buttonTextDefault}}])&&s(e.prototype,n),a}(u);function _(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var v=function(){function t(e){var n=e.nameSelector,o=e.aboutSelector,r=e.avatarUserPhoto;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._userName=document.querySelector(n),this._userAbout=document.querySelector(o),this._avatarUser=r}var e,n;return e=t,(n=[{key:"getUserInfo",value:function(){return{name:this._userName.textContent,about:this._userAbout.textContent}}},{key:"setUserInfo",value:function(t){this._userName.textContent=t.name,this._userAbout.textContent=t.about,this._userOwnerId=t._id}},{key:"setUserPhoto",value:function(t){this._avatarUser.src=t.avatar}},{key:"getOwnerId",value:function(){return this._userOwnerId}},{key:"updateUserAvatar",value:function(t){this._avatarUser.src=t}}])&&_(e.prototype,n),t}();function y(t){return(y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function b(t,e,n){return(b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var o=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=E(t)););return t}(t,e);if(o){var r=Object.getOwnPropertyDescriptor(o,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function g(t,e){return(g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function k(t,e){return!e||"object"!==y(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function E(t){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var S=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&g(t,e)}(a,t);var e,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=E(o);if(r){var n=E(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return k(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=i.call(this,t))._photoPopupCard=document.querySelector(".popup__photo"),e._captionPopupCard=document.querySelector(".popup__caption"),e}return e=a,(n=[{key:"open",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:cardData,e=t.name,n=t.link;this._photoPopupCard.src=n,this._photoPopupCard.alt=e,this._captionPopupCard.textContent=e,b(E(a.prototype),"open",this).call(this)}}])&&m(e.prototype,n),a}(u);function L(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var C=function(t){return t.ok?t.json():Promise.reject("Error: ".concat(t.status))},w=function(){function t(e){var n=e.token,o=e.groupID;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._token=n,this._groupID=o}var e,n;return e=t,(n=[{key:"getUser",value:function(){return fetch("https://mesto.nomoreparties.co/v1/".concat(this._groupID,"/users/me"),{headers:{authorization:this._token,method:"GET"}}).then(C).catch((function(t){console.log(t)}))}},{key:"getCards",value:function(){return fetch("https://mesto.nomoreparties.co/v1/".concat(this._groupID,"/cards"),{method:"GET",headers:{authorization:this._token}}).then(C).catch((function(t){console.log(t)}))}},{key:"sendUser",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:userData,e=t.name,n=t.about;return fetch("https://mesto.nomoreparties.co/v1/".concat(this._groupID,"/users/me"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:n})}).then(C).catch((function(t){console.log(t)}))}},{key:"addCard",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:cardData,e=t.Title,n=t.Link;return fetch("https://mesto.nomoreparties.co/v1/".concat(this._groupID,"/cards"),{method:"POST",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({name:e,link:n})}).then(C).catch((function(t){console.log(t)}))}},{key:"removeCard",value:function(t){return fetch("https://mesto.nomoreparties.co/v1/".concat(this._groupID,"/cards/").concat(t),{method:"DELETE",headers:{authorization:this._token}}).then(C).catch((function(t){console.log(t)}))}},{key:"likeCard",value:function(t){return fetch("https://mesto.nomoreparties.co/v1/".concat(this._groupID,"/cards/likes/").concat(t),{method:"PUT",headers:{authorization:this._token}}).then(C).catch((function(t){console.log(t)}))}},{key:"deleteLikeCard",value:function(t){return fetch("https://mesto.nomoreparties.co/v1/".concat(this._groupID,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:this._token}}).then(C).catch((function(t){console.log(t)}))}},{key:"updateAvatar",value:function(t){return fetch("https://mesto.nomoreparties.co/v1/".concat(this._groupID,"/users/me/avatar"),{method:"PATCH",headers:{authorization:this._token,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then(C).catch((function(t){console.log(t)}))}}])&&L(e.prototype,n),t}();function O(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var P=document.querySelector(".popup_profile"),I=document.querySelector(".popup_add"),q=document.querySelector(".popup_update-avatar"),A=document.querySelector(".popup_delete-card"),j=document.querySelector(".user__edit-button"),D=document.querySelector(".user__avatar"),x=document.querySelector(".user-photo"),T=document.querySelector(".popup__form_profile"),B=document.querySelector(".popup__form_add"),U=document.querySelector(".popup__form_update-avatar"),R=document.querySelector(".popup__input_text_name"),V=document.querySelector(".popup__input_text_about"),z=document.querySelector(".add-button"),F=document.querySelector(".popup_photo"),N={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:".popup__save-button_inactive",textError:".popup__input-error",activeTextError:"popup__input-error_active",inputErrorActive:"popup__input_error",submitCardButton:".popup__save-button_add",formAddCard:".popup__form_add",formEditProfile:".popup__form_profile",submitUpdateAvatar:".popup__save-button_update-avatar",submitEditProfile:".popup__save-button_profile"},J=new w({token:"98ab6b78-4926-4ba2-b164-ff0669091526",groupID:"cohort-22"});Promise.all([J.getUser(),J.getCards()]).then((function(t){var e,n,o=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],o=!0,r=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(o=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);o=!0);}catch(t){r=!0,i=t}finally{try{o||null==u.return||u.return()}finally{if(r)throw i}}return n}}(e,n)||function(t,e){if(t){if("string"==typeof t)return O(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],i=o[1];X.setUserInfo(r),X.setUserPhoto(r),X.getOwnerId(r),M.renderer(i)})).catch((function(t){console.log(t)}));var G=new S(F);G.setEventListeners();var H=function(t){var e=new o(t,".template",(function(){G.open(t)}),(function(t){J.likeCard(t).catch((function(t){console.error(t)}))}),(function(t){J.deleteLikeCard(t).catch((function(t){console.error(t)}))}),(function(t,e){W.openPopupDelete(t,e)}),X.getOwnerId()).generateCard();M.addItem(e)},M=new e({renderer:function(t){H(t)}},".photos-grid"),$=new d({submitFunction:function(t){$.renderLoading(!0,"Сохранение..."),J.sendUser(t).then((function(){X.setUserInfo(t),$.close()})).catch((function(t){console.log("Ой йой, ошибка ".concat(t.status))})).finally($.renderLoading(!1,"Сохранение..."))}},P);$.setEventListeners();var K=new d({submitFunction:function(t){K.renderLoading(!0,"Создание..."),J.addCard(t).then((function(e){var n={name:t.Title,link:t.Link,_id:e._id,likes:e.likes,owner:{_id:e.owner._id}};H(n),K.close()})).catch((function(t){console.log("Ой йой, ошибка ".concat(t.status))})).finally(K.renderLoading(!1,"Создание..."))}},I);K.setEventListeners();var Q=new d({submitFunction:function(t){Q.renderLoading(!0,"Сохранение...");var e=t.AvatarLink;J.updateAvatar(e).then((function(){X.updateUserAvatar(e),Q.close()})).catch((function(t){console.log(t)})).finally(Q.renderLoading(!1,"Сохранение..."))}},q);Q.setEventListeners();var W=new d({submitFunction:function(t,e){W.renderLoading(!0,"Удаление..."),J.removeCard(t).then((function(){e.remove(),W.close()})).catch((function(t){console.log("Ошибка ".concat(t.status," при удалении")),console.error(t)})).finally(W.renderLoading(!1,"Удаление..."))}},A);W.setEventListenersDelete();var X=new v({nameSelector:".user__name",aboutSelector:".user__about",avatarUserPhoto:D}),Y=new i(N,T),Z=new i(N,B),tt=new i(N,U),et=function(t){var e=document.querySelector(t);e.setAttribute("disabled",!0),e.classList.add(N.inactiveButtonClass)};j.addEventListener("click",(function(){var t,e;$.open(),Y.resetErrorOpenPopup(),R.value=X.getUserInfo().name,V.value=X.getUserInfo().about,t=N.submitEditProfile,(e=document.querySelector(t)).removeAttribute("disabled"),e.classList.remove(N.inactiveButtonClass)})),z.addEventListener("click",(function(){K.open(),Z.resetErrorOpenPopup(),et(N.submitCardButton)})),x.addEventListener("click",(function(){Q.open(),tt.resetErrorOpenPopup(),et(N.submitUpdateAvatar)})),Y.enableValidation(),Z.enableValidation(),tt.enableValidation()})();